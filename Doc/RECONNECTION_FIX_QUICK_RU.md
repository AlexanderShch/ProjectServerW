# Исправление проблемы переподключения - Краткая справка

## Проблема
Клиент не мог переподключиться сразу после разрыва соединения - сервер отклонял новое соединение в течение 2 минут (пока шла запись Excel).

## Решение
Форма теперь закрывается **немедленно** после запуска записи в Excel. Запись продолжается в фоновом потоке.

## Что изменилось

### DataForm.cpp - DataForm_FormClosing (строки ~945-975)

**РАНЬШЕ:**
```cpp
e->Cancel = true;                    // Блокируем закрытие
TriggerExcelExport();                // Запускаем запись
WaitOne(60*60*1000);                 // ЖДЁМ 60 минут!
e->Cancel = false;                   // Теперь можно закрыть
```

**СЕЙЧАС:**
```cpp
TriggerExcelExport();                // Запускаем запись в фоне
e->Cancel = false;                   // Закрываем СРАЗУ
```

## Результат

- Форма закрывается за **миллисекунды**
- Клиент может переподключиться **немедленно**
- Данные **все равно сохраняются** в фоне
- Новая форма начинает работать **без ожидания**

## Проверка

1. Подключить клиента
2. Разорвать соединение
3. Сразу переподключиться
4. ? Соединение принято
5. ? Старый файл сохранен

## Безопасность

- Excel получает **копию** данных перед закрытием формы
- Все обращения к UI **защищены** проверками
- Фоновый поток **не зависит** от состояния формы

