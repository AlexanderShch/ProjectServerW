# –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏

**–î–∞—Ç–∞:** 25 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—É–ø–∞–∫–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** (packed structures) —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º `__attribute__((packed))` –¥–ª—è GCC, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –±–∞–π—Ç–æ–≤.

–ë–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å **padding –±–∞–π—Ç—ã** –º–µ–∂–¥—É –ø–æ–ª—è–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–∞—Ä—Å–∏–Ω–≥—É** –¥–∞–Ω–Ω—ã—Ö.

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ MSGQUEUE_OBJ_t

### –ü–æ–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

| –ü–æ–ª–µ | –¢–∏–ø | –†–∞–∑–º–µ—Ä | –°–º–µ—â–µ–Ω–∏–µ –±–µ–∑ pack | –°–º–µ—â–µ–Ω–∏–µ —Å pack(1) |
|------|-----|--------|-------------------|-------------------|
| Time | uint16_t | 2 –±–∞–π—Ç–∞ | 0 | 0 |
| SensorQuantity | uint8_t | 1 –±–∞–π—Ç | 2 | 2 |
| (padding) | - | 1 –±–∞–π—Ç | 3 | - |
| SensorType[7] | uint8_t[7] | 7 –±–∞–π—Ç | 4 | 3 |
| Active[7] | uint8_t[7] | 7 –±–∞–π—Ç | 11 | 10 |
| (padding) | - | 1 –±–∞–π—Ç | 18 | - |
| T[7] | short[7] | 14 –±–∞–π—Ç | 20 | 17 |
| H[7] | short[7] | 14 –±–∞–π—Ç | 34 | 31 |
| CRC_SUM | uint16_t | 2 –±–∞–π—Ç–∞ | 48 | 45 |
| **–ò–¢–û–ì–û** | | **48 –±–∞–π—Ç** (pack) | **50 –±–∞–π—Ç** (–±–µ–∑ pack) | **47 –±–∞–π—Ç** (pack(1)) |

**–í–Ω–∏–º–∞–Ω–∏–µ:** –†–∞–∑–º–µ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç SQ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–Ω—Å–æ—Ä–æ–≤).
- SQ = 7 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ DataForm.h)

### –†–∞—Å—á–µ—Ç —Ä–∞–∑–º–µ—Ä–∞ (—Å pack(1)):
```
uint16_t Time           =  2 –±–∞–π—Ç–∞
uint8_t SensorQuantity  =  1 –±–∞–π—Ç
uint8_t SensorType[7]   =  7 –±–∞–π—Ç
uint8_t Active[7]       =  7 –±–∞–π—Ç
short T[7]              = 14 –±–∞–π—Ç (7 * 2)
short H[7]              = 14 –±–∞–π—Ç (7 * 2)
uint16_t CRC_SUM        =  2 –±–∞–π—Ç–∞
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û                   = 47 –±–∞–π—Ç
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –≤ SServer.cpp:** 48 –±–∞–π—Ç (–≤–∫–ª—é—á–∞—è –ø–µ—Ä–≤—ã–π –±–∞–π—Ç Type=0x00)

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ë—ã–ª–æ (DataForm.cpp —Å—Ç—Ä–æ–∫–∏ 15-25):
```cpp
//
typedef struct   // object data for Server type –∏–∑ STM32
{
    uint16_t Time;
    uint8_t SensorQuantity;
    uint8_t SensorType[SQ];
    uint8_t Active[SQ];
    short T[SQ];
    short H[SQ];
    uint16_t CRC_SUM;
} MSGQUEUE_OBJ_t;
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å padding –±–∞–π—Ç—ã –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –ø–æ–ª–µ–π.

---

### –°—Ç–∞–ª–æ (DataForm.cpp —Å—Ç—Ä–æ–∫–∏ 15-28):
```cpp
// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –æ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ (—É–ø–∞–∫–æ–≤–∞–Ω–Ω–∞—è, –±–µ–∑ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –±–∞–π—Ç–æ–≤)
// –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç __attribute__((packed)), –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ–º #pragma pack(1)
#pragma pack(push, 1)
typedef struct   // object data for Server type –∏–∑ STM32
{
    uint16_t Time;				// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥ —Å –º–æ–º–µ–Ω—Ç–∞ –≤–∫–ª—é—á–µ–Ω–∏—è
    uint8_t SensorQuantity;		// –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–Ω—Å–æ—Ä–æ–≤
    uint8_t SensorType[SQ];		// –¢–∏–ø —Å–µ–Ω—Å–æ—Ä–∞
    uint8_t Active[SQ];			// –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–µ–Ω—Å–æ—Ä–∞
    short T[SQ];				// –ó–Ω–∞—á–µ–Ω–∏–µ 1 —Å–µ–Ω—Å–æ—Ä–∞ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞)
    short H[SQ];				// –ó–Ω–∞—á–µ–Ω–∏–µ 2 —Å–µ–Ω—Å–æ—Ä–∞ (–≤–ª–∞–∂–Ω–æ—Å—Ç—å)
    uint16_t CRC_SUM;			// –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
} MSGQUEUE_OBJ_t;
#pragma pack(pop)
```

**–†–µ—à–µ–Ω–∏–µ:** 
- `#pragma pack(push, 1)` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ –Ω–∞ 1 –±–∞–π—Ç (–±–µ–∑ padding)
- `#pragma pack(pop)` - –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ

---

## üîç –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ë–µ–∑ #pragma pack(1):
```
Offset: 0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16 17 18 19 ...
       [Time][SQ][P][SensorType................][Active............][P]...
```
`[P]` = padding –±–∞–π—Ç (–¥–æ–±–∞–≤–ª–µ–Ω –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º)

### –° #pragma pack(1):
```
Offset: 0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16 17 18 19 ...
       [Time][SQ][SensorType................][Active............][T[0]]...
```
–ù–µ—Ç padding –±–∞–π—Ç–æ–≤, –¥–∞–Ω–Ω—ã–µ –∏–¥—É—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

### –í SServer.cpp (—Å—Ç—Ä–æ–∫–∞ 320):
```cpp
uint8_t LengthOfPackage = 48;
```

**–í–∞–∂–Ω–æ:** –≠—Ç–æ —Ä–∞–∑–º–µ—Ä –ø–∞–∫–µ—Ç–∞ **–≤–∫–ª—é—á–∞—è –ø–µ—Ä–≤—ã–π –±–∞–π—Ç Type=0x00**.

**–†–∞–∑–±–∏–≤–∫–∞ 48 –±–∞–π—Ç:**
- 1 –±–∞–π—Ç: Type (0x00 –¥–ª—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏)
- 47 –±–∞–π—Ç: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ MSGQUEUE_OBJ_t (—Å pack(1))

---

## ‚ö†Ô∏è –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### 1. –†–∞–∑–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ:
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ (STM32) —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–∫–æ–π –∂–µ:
```c
// –ù–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ (GCC):
typedef struct __attribute__((packed)) {
    uint16_t Time;
    uint8_t SensorQuantity;
    uint8_t SensorType[7];
    uint8_t Active[7];
    short T[7];
    short H[7];
    uint16_t CRC_SUM;
} MSGQUEUE_OBJ_t;

// –†–∞–∑–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 47 –±–∞–π—Ç
static_assert(sizeof(MSGQUEUE_OBJ_t) == 47, "Structure size mismatch");
```

### 2. –§–æ—Ä–º–∞—Ç –ø–∞–∫–µ—Ç–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏:
```
–ë–∞–π—Ç 0:    Type = 0x00 (—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è)
–ë–∞–π—Ç 1-47: MSGQUEUE_OBJ_t (47 –±–∞–π—Ç)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–¢–û–ì–û:     48 –±–∞–π—Ç
```

### 3. CRC –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –¥–ª—è:
```cpp
// –í SServer.cpp (—Å—Ç—Ä–æ–∫–∞ 322):
uint16_t dataCRC = MB_GetCRC(buffer, LengthOfPackage - 2);
```
CRC –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–≤—ã—Ö **46 –±–∞–π—Ç** (48 - 2):
- –ë–∞–π—Ç 0: Type (0x00)
- –ë–∞–π—Ç 1-45: –≤—Å–µ –ø–æ–ª—è –∫—Ä–æ–º–µ CRC_SUM
- –ë–∞–π—Ç 46-47: CRC_SUM (–Ω–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Ä–∞—Å—á–µ—Ç)

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ —Ç–µ–ø–µ—Ä—å —É–ø–∞–∫–æ–≤–∞–Ω–∞** (`#pragma pack(1)`)  
‚úÖ **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç—É –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞** (–±–µ–∑ padding –±–∞–π—Ç–æ–≤)  
‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö** –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω  
‚úÖ **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å GCC** `__attribute__((packed))`

---

## üìö –°–ø—Ä–∞–≤–∫–∞

### –†–∞–∑–ª–∏—á–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞–º–∏:

| –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä | –°–∏–Ω—Ç–∞–∫—Å–∏—Å |
|------------|-----------|
| **GCC** | `__attribute__((packed))` |
| **MSVC** | `#pragma pack(1)` |
| **Clang** | `__attribute__((packed))` –∏–ª–∏ `#pragma pack(1)` |

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:

**GCC/Clang:**
```c
typedef struct __attribute__((packed)) {
    // ...
} MyStruct_t;
```

**MSVC (Visual Studio):**
```cpp
#pragma pack(push, 1)
typedef struct {
    // ...
} MyStruct_t;
#pragma pack(pop)
```

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 25 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ


